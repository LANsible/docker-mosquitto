---
image: docker:19.03

services:
  - docker:19.03-dind

variables:
  DOCKER_IMAGE_NAME: lansible/mosquitto

include:
  - template: Container-Scanning.gitlab-ci.yml
  - remote: https://raw.githubusercontent.com/LANsible/gitlab-includes/master/docker-login.yml
  - remote: https://raw.githubusercontent.com/LANsible/gitlab-includes/master/docker-build.yml
  - remote: https://raw.githubusercontent.com/LANsible/gitlab-includes/master/sast-cis-benchmark.yml

stages:
  - build
  - post-build
  - test
  - publish

publish_branch:
  variables:
    DOCKER_IMAGE_NAME: ${DOCKER_IMAGE_NAME}

publish_tag:
  variables:
    DOCKER_IMAGE_NAME: ${DOCKER_IMAGE_NAME}

publish_latest:
  variables:
    DOCKER_IMAGE_NAME: ${DOCKER_IMAGE_NAME}
